### 简单动态字符串SDS

* 由使用长度,剩余容量,字符串(字符数组)组成
* 字符串部分与c语言相同,结尾都有'\0'标志且不计入长度,由于是二进制安全的,所以字符中的'\0'不会导致SDS中途截断,同时也会计入长度
* 可以有效杜绝缓冲区溢出问题,通过内存预分配减少字符串操作时申请内存的次数:字符长度低于1MB时,预分配会将长度加倍并+1个字节(byte)用于结尾的'\0'字符,大于1MB时会额外分配1MB+1个字节长度
* 字符长度减少时则使用惰性策略,不主动释放内存并使用剩余容量来记录剩余可用容量
* SDS是二进制安全的,不会限制数据的格式

### 链表

* 分为listNode与list两部分
* listNode由前置节点指针,后置节点指针,节点值组成,是双向链表
* list则由链表头节点指针,链表尾节点指针,链表节点数,节点复制函数,节点释放函数,节点值对比函数组成
* 链表被用于列表键,发布订阅,慢查询,监视器等
* 头节点的头节点指针与尾节点的尾节点指针都指向null,是无环链表
* 通过list的三个函数指针可以使链表存储不同类型的值

### 字典

* 字典由dict,dictht与dicEntry组成
* dictEntry由键,值,下一个同哈希值的哈希表节点指针组成
* dictht由哈希表数组,哈希表大小,哈希表大小掩码(用于计算索引值,值为哈希表大小-1),哈希表已有节点数量组成
* dict由类型特定函数(计算哈希值函数,复制键函数,复制值函数,对比键函数,销毁键函数,销毁值函数),私有数据,哈希表,rehash索引(不在rehash时值为-1)组成
* 当多个键值通过哈希得到相同的值,字典将使用哈希表节点指针将他们连接起来组成单链表结构
* 当数据不断更新,为了使负载因子(已保存节点数量/哈希表大小)合理,redis会对哈希表进行渐进式rehash来扩缩容
* 一个字典由两份dictht组成,第二个dictht用来做rehash时使用

### 跳跃表

* 跳跃表由zskiplistNode与zskiplist组成
* zskiplist由跳跃表头节点指针,跳跃表尾节点指针,跳跃表长度,节点中的最大层数组成
* zskiplistNode由后退指针,分值,节点值(SDS),层(前进指针与跨度(用来计算排位)组成的数组)组成
* 跳跃表是有序的,节点值必须唯一,存在相同的分值时以节点值排序
* 跳跃表的层数是1-32之间的随机数

> http://zhangtielei.com/posts/blog-redis-skiplist.html

### 整数集合

* 由编码方式(int16,int32,int64),元素数量,保存元素的数组组成
* 当更新元素时如果类型不匹配则会升级元素类型(不会降级),重新申请内存分配空间
* 是节约内存的顺序型数据结构

### 压缩列表

* 是一块连续的内存,主要由节点构成,非节点部分则记录了压缩列表信息,是节约内存的顺序型数据结构
* 非节点部分由总容量,起始点与尾节点字节数,节点数量,列表节点,0xFF(压缩列表结尾标志)组成
* 节点部分由前节点长度(1或5字节),节点编码(保存了数据类型与长度),节点内容组成
* 节点的更新可能会导致连锁更新,但出现几率不高

### 对象

* 由类型(redis的五种数据类型),编码(上述的数据结构与long类型整数),底层数据结构指针组成
* 字符串对象:整数,embstr编码的SDS,SDS
* 列表:压缩列表,链表
* 哈希表:压缩列表,字典
* 集合(唯一):整数集合,字典
* 有序集合(唯一有序):压缩列表,跳跃表与字典实现的有序集合
* redis数据库中的每个键值对的键和值都是一个对象
* 集合的返回是随机的,元素是唯一的
* 有序集合使用跳跃表和字典实现是为了使范围操作和查找都能快速执行
* redis只共享整数对象(默认0-9999),而不共享字符串对象因为字符串的比较需要消耗额外资源
* redis采用引用计数的方式来回收内存
* 对象会记录最后一次被访问时间,用于计算空转时间


